<div class="modal fade" id="bookDetailsModal" tabindex="-1" aria-labelledby="bookDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content bg-body">

      <div class="modal-header border-0 position-absolute w-100 p-4" style="z-index: 1050; background: transparent;">
        <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="modal" aria-label="Close"
          style="filter: invert(1); opacity: 0.8;"></button>
      </div>

      <div class="modal-body p-0 overflow-y-auto custom-scrollbar">

        <div class="book-hero-container position-relative overflow-hidden text-white">
          <div class="book-hero-bg position-absolute top-0 start-0 w-100 h-100" id="detail-hero-bg"></div>
          <div class="book-hero-overlay position-absolute top-0 start-0 w-100 h-100"></div>

          <div class="container position-relative pt-5" style="z-index: 2;">
            <div class="row">

              <div
                class="col-12 col-md-4 col-lg-4 mb-4 mb-md-0 text-center text-md-start d-flex justify-content-center align-items-center">
                <div class="book-cover-wrapper">
                  <img src="" id="detail-cover" class="book-cover-img" alt="Cover" onerror="handleBookCoverError(this)">
                </div>
              </div>

              <div class="col-12 col-md-8 col-lg-8 d-flex flex-column justify-content-between text-center text-md-start">
                <div id="detail-header-text">
                  <h1 class="display-5 fw-bold mb-2" id="detail-title">
                    <a id="detail-title-link" href="#" target="_blank" rel="noopener noreferrer" class="text-reset text-decoration-none">Title</a>
                  </h1>
                  <div
                    class="fs-5 mb-3 text-white-75 d-flex align-items-center justify-content-center justify-content-md-start gap-1"
                    id="detail-subtitle"></div>

                  <div class="mb-1"><strong>By:</strong> <span id="detail-authors">---</span></div>
                  <div class="mb-3"><strong>Narrated by:</strong> <span id="detail-narrators">---</span></div>
                  <div id="full" class="badge-container justify-content-center justify-content-md-start gap-1" style="text-shadow:none;">
                    <span id="badge-downloaded" class="badge bg-success d-none"
                      style="font-size: 0.6rem;">Downloaded</span>
                    <span id="badge-vip" class="badge bg-warning text-dark d-none" style="font-size: 0.6rem;">VIP</span>
                    <span id="badge-freeleech" class="badge bg-info text-dark d-none" style="font-size: 0.6rem;"
                      data-bs-toggle="tooltip" data-bs-placement="bottom" title="Freeleech">Freeleech</span>
                  </div>

                </div>
                <div id="details-footer" style="text-shadow:none;">
                  <div class="col-12" id="progress-notifications">
                    <div class="response-message-result mt-1 small"></div>
                    <div class="torrent-status-container small"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row align-items-center align-items-md-start">
              <div class="col-12 col-md-4 col-lg-4 mb-4 mb-md-0 text-center text-md-start d-none d-md-block"></div>
              <div class="col-12 col-md-8 col-lg-8 d-flex flex-column justify-content-center text-center text-md-start">
                <div class="d-flex gap-3 mt-3 flex-wrap justify-content-center justify-content-md-start">
                  <button id="detail-download-btn"
                    class="btn btn-warning btn-lg px-5 fw-bold rounded-pill text-dark border-0">
                    <i class="bi bi-play-fill me-1"></i> Download
                  </button>

                  <a id="detail-torrent-link" href="#" target="_blank"
                    class="btn btn-outline-adaptive btn-lg px-4 rounded-pill border">
                    <i class="bi bi-file-earmark-arrow-down"></i> Save .torrent
                  </a>

                  <div class="form-floating text-dark">
                    <select name="category" class="form-select shadow-sm category-dropdown"
                        style="font-size: 0.85rem; min-width: 140px;" id="detail-cat-select">
                        <option value="" {% if not TORRENT_CLIENT_CATEGORY %}selected{% endif %}>Default</option>
                        {% for category_name, category_info in categories.items() %}
                        <option value="{{ category_name }}" {% if TORRENT_CLIENT_CATEGORY==category_name %}selected{%
                            endif %}>
                            {{ category_name }}
                        </option>
                        {% endfor %}
                    </select>
                    <label for="detail-cat-select" style="font-size: 0.85rem;">Category</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="container py-5 pt-md-4 pb-md-5">
          <div class="row">
            <div class="col-12 col-lg-8 pe-lg-5">
              <h4 class="border-bottom pb-2 mb-3 text-body-emphasis">Description</h4>
              <div id="detail-description" class="lead fs-6 text-body-secondary" style="line-height: 1.7;"></div>

              <div class="mt-4" id="detail-tags-container">
                <h5 class="mb-2 text-body-tertiary small text-uppercase">Tags</h5>
                <div id="detail-tags" class="d-flex flex-wrap gap-2"></div>
              </div>
            </div>

            <div class="col-12 col-lg-4 mt-5 mt-lg-0">
              <div class="p-4 rounded-3 bg-body-tertiary border border-opacity-10 border-secondary">
                <h5 class="mb-3 text-body-emphasis">Book Details</h5>
                <ul class="list-unstyled mb-0 d-grid gap-2 small">
                  <li class="d-flex justify-content-between">
                    <span class="text-body-secondary">Category:</span>
                    <span class="fw-medium text-body-emphasis text-end" id="detail-category">---</span>
                  </li>
                  <li class="d-flex justify-content-between">
                    <span class="text-body-secondary">Language:</span>
                    <span class="fw-medium text-body-emphasis text-end" id="detail-language">---</span>
                  </li>
                  <li class="d-flex justify-content-between">
                    <span class="text-body-secondary">File Type:</span>
                    <span class="fw-medium text-body-emphasis text-end" id="detail-filetype">---</span>
                  </li>
                  <li class="d-flex justify-content-between">
                    <span class="text-body-secondary">Size:</span>
                    <span class="fw-medium text-body-emphasis text-end" id="detail-size">---</span>
                  </li>
                  <li class="d-flex justify-content-between">
                    <span class="text-body-secondary">Added on:</span>
                    <span class="fw-medium text-body-emphasis text-end" id="detail-added">---</span>
                  </li>
                  <hr class="text-secondary opacity-25">
                  <li class="d-flex justify-content-between">
                    <span class="text-body-secondary">Seeders:</span>
                    <span class="fw-bold text-success text-end" id="detail-seeders">0</span>
                  </li>
                  <li class="d-flex justify-content-between">
                    <span class="text-body-secondary">Leechers:</span>
                    <span class="fw-bold text-danger text-end" id="detail-leechers">0</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="coverLightboxModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-transparent border-0 shadow-none">
      <div class="modal-body p-0 text-center">
        <div class="d-inline-block position-relative">

          <button type="button" class="btn-close position-absolute top-0 end-0 border border-secondary"
            aria-label="Close" data-bs-dismiss="modal" style="
              /* 1. Force full visibility */
              opacity: 1; 
              
              /* 2. Set base to White, then invert everything (White bg becomes Black, Black X becomes White) */
              background-color: white; 
              filter: invert(1); 
              
              /* 3. Shape and spacing */
              border-radius: 50%; 
              padding: 0.75rem; 
              margin: 0.25rem;     
              z-index: 1070;
            ">
          </button>

          <img id="lightbox-img" src="" class="img-fluid rounded shadow-lg border"
            style="max-height: 90vh; object-fit: contain;">

        </div>

      </div>
    </div>
  </div>
</div>